<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>StoreBucketProperties.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Riak Client for Java</a> &gt; <a href="index.source.html" class="el_package">com.basho.riak.client.api.commands.buckets</a> &gt; <span class="el_source">StoreBucketProperties.java</span></div><h1>StoreBucketProperties.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2013 Basho Technologies Inc
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package com.basho.riak.client.api.commands.buckets;

import com.basho.riak.client.api.AsIsRiakCommand;
import com.basho.riak.client.core.operations.StoreBucketPropsOperation;
import com.basho.riak.client.core.query.Namespace;
import com.basho.riak.client.core.query.functions.Function;

/**
 * Command used to store (modify) the properties of a bucket in Riak.
 * &lt;p&gt;
 * &lt;pre class=&quot;prettyprint&quot;&gt;
 * {@code
 * Namespace ns = new Namespace(&quot;my_type&quot;, &quot;my_bucket&quot;);
 * StoreBucketProperties sbp =
 *  new StoreBucketProperties.Builder(ns)
 *      .withAllowMulti(true)
 *      .build();
 * client.execute(sbp);}&lt;/pre&gt;
 * &lt;/p&gt;
 * @author Dave Rusek &lt;drusek at basho dot com&gt;
 * @since 2.0
 */
public final class StoreBucketProperties extends AsIsRiakCommand&lt;Void, Namespace&gt;
{
    private final Namespace namespace;
    private final Boolean allowMulti;
    private final String backend;
    private final Boolean basicQuorum;
    private final Long bigVClock;
    private final Function chashkeyFunction;
    private final Boolean lastWriteWins;
    private final Function linkWalkFunction;
    private final Integer rw;
    private final Integer dw;
    private final Integer w;
    private final Integer r;
    private final Integer pr;
    private final Integer pw;
    private final Boolean notFoundOk;
    private final Function preCommitHook;
    private final Function postCommitHook;
    private final Long oldVClock;
    private final Long youngVClock;
    private final Long smallVClock;
    private final Integer nval;
    private final Boolean legacySearch;
    private final String searchIndex;
    private final Integer hllPrecision;

    StoreBucketProperties(Builder builder)
<span class="nc" id="L67">    {</span>
<span class="nc" id="L68">        this.namespace = builder.namespace;</span>
<span class="nc" id="L69">        this.allowMulti = builder.allowMulti;</span>
<span class="nc" id="L70">        this.backend = builder.backend;</span>
<span class="nc" id="L71">        this.bigVClock = builder.bigVClock;</span>
<span class="nc" id="L72">        this.chashkeyFunction = builder.chashkeyFunction;</span>
<span class="nc" id="L73">        this.lastWriteWins = builder.lastWriteWins;</span>
<span class="nc" id="L74">        this.basicQuorum = builder.basicQuorum;</span>
<span class="nc" id="L75">        this.linkWalkFunction = builder.linkWalkFunction;</span>
<span class="nc" id="L76">        this.rw = builder.rw;</span>
<span class="nc" id="L77">        this.dw = builder.dw;</span>
<span class="nc" id="L78">        this.w = builder.w;</span>
<span class="nc" id="L79">        this.pr = builder.pr;</span>
<span class="nc" id="L80">        this.pw = builder.pw;</span>
<span class="nc" id="L81">        this.r = builder.r;</span>
<span class="nc" id="L82">        this.notFoundOk = builder.notFoundOk;</span>
<span class="nc" id="L83">        this.preCommitHook = builder.preCommitHook;</span>
<span class="nc" id="L84">        this.postCommitHook = builder.postCommitHook;</span>
<span class="nc" id="L85">        this.oldVClock = builder.oldVClock;</span>
<span class="nc" id="L86">        this.youngVClock = builder.youngVClock;</span>
<span class="nc" id="L87">        this.smallVClock = builder.smallVClock;</span>
<span class="nc" id="L88">        this.nval = builder.nval;</span>
<span class="nc" id="L89">        this.legacySearch = builder.legacySearch;</span>
<span class="nc" id="L90">        this.searchIndex = builder.searchIndex;</span>
<span class="nc" id="L91">        this.hllPrecision = builder.hllPrecision;</span>
<span class="nc" id="L92">    }</span>

    @Override
    protected StoreBucketPropsOperation buildCoreOperation()
    {
<span class="nc" id="L97">        StoreBucketPropsOperation.Builder builder =</span>
            new StoreBucketPropsOperation.Builder(namespace);

<span class="nc bnc" id="L100" title="All 2 branches missed.">        if (allowMulti != null)</span>
        {
<span class="nc" id="L102">            builder.withAllowMulti(allowMulti);</span>
        }

<span class="nc bnc" id="L105" title="All 2 branches missed.">        if (backend != null)</span>
        {
<span class="nc" id="L107">            builder.withBackend(backend);</span>
        }

<span class="nc bnc" id="L110" title="All 2 branches missed.">        if (basicQuorum != null)</span>
        {
<span class="nc" id="L112">            builder.withBasicQuorum(basicQuorum);</span>
        }

<span class="nc bnc" id="L115" title="All 2 branches missed.">        if (bigVClock != null)</span>
        {
<span class="nc" id="L117">            builder.withBigVClock(bigVClock);</span>
        }

<span class="nc bnc" id="L120" title="All 2 branches missed.">        if (chashkeyFunction != null)</span>
        {
<span class="nc" id="L122">            builder.withChashkeyFunction(chashkeyFunction);</span>
        }

<span class="nc bnc" id="L125" title="All 2 branches missed.">        if (lastWriteWins != null)</span>
        {
<span class="nc" id="L127">            builder.withLastWriteWins(lastWriteWins);</span>
        }

<span class="nc bnc" id="L130" title="All 2 branches missed.">        if (linkWalkFunction != null)</span>
        {
<span class="nc" id="L132">            builder.withLinkwalkFunction(linkWalkFunction);</span>
        }

<span class="nc bnc" id="L135" title="All 2 branches missed.">        if (rw != null)</span>
        {
<span class="nc" id="L137">            builder.withRw(rw);</span>
        }

<span class="nc bnc" id="L140" title="All 2 branches missed.">        if (dw != null)</span>
        {
<span class="nc" id="L142">            builder.withDw(dw);</span>
        }

<span class="nc bnc" id="L145" title="All 2 branches missed.">        if (w != null)</span>
        {
<span class="nc" id="L147">            builder.withW(w);</span>
        }

<span class="nc bnc" id="L150" title="All 2 branches missed.">        if (r != null)</span>
        {
<span class="nc" id="L152">            builder.withR(r);</span>
        }

<span class="nc bnc" id="L155" title="All 2 branches missed.">        if (pr != null)</span>
        {
<span class="nc" id="L157">            builder.withPr(pr);</span>
        }

<span class="nc bnc" id="L160" title="All 2 branches missed.">        if (pw != null)</span>
        {
<span class="nc" id="L162">            builder.withPw(pw);</span>
        }

<span class="nc bnc" id="L165" title="All 2 branches missed.">        if (notFoundOk != null)</span>
        {
<span class="nc" id="L167">            builder.withNotFoundOk(notFoundOk);</span>
        }

<span class="nc bnc" id="L170" title="All 2 branches missed.">        if (preCommitHook != null)</span>
        {
<span class="nc" id="L172">            builder.withPrecommitHook(preCommitHook);</span>
        }

<span class="nc bnc" id="L175" title="All 2 branches missed.">        if (postCommitHook != null)</span>
        {
<span class="nc" id="L177">            builder.withPostcommitHook(postCommitHook);</span>
        }

<span class="nc bnc" id="L180" title="All 2 branches missed.">        if (oldVClock != null)</span>
        {
<span class="nc" id="L182">            builder.withOldVClock(oldVClock);</span>
        }

<span class="nc bnc" id="L185" title="All 2 branches missed.">        if (youngVClock != null)</span>
        {
<span class="nc" id="L187">            builder.withYoungVClock(youngVClock);</span>
        }

<span class="nc bnc" id="L190" title="All 2 branches missed.">        if (smallVClock != null)</span>
        {
<span class="nc" id="L192">            builder.withSmallVClock(smallVClock);</span>
        }

<span class="nc bnc" id="L195" title="All 2 branches missed.">        if (nval != null)</span>
        {
<span class="nc" id="L197">            builder.withNVal(nval);</span>
        }

<span class="nc bnc" id="L200" title="All 2 branches missed.">        if (legacySearch != null)</span>
        {
<span class="nc" id="L202">            builder.withLegacyRiakSearchEnabled(legacySearch);</span>
        }

<span class="nc bnc" id="L205" title="All 2 branches missed.">        if (searchIndex != null)</span>
        {
<span class="nc" id="L207">            builder.withSearchIndex(searchIndex);</span>
        }

<span class="nc bnc" id="L210" title="All 2 branches missed.">        if (hllPrecision != null)</span>
        {
<span class="nc" id="L212">            builder.withHllPrecision(hllPrecision);</span>
        }

<span class="nc" id="L215">        return builder.build();</span>
    }

    public static class Builder
    {
        private final Namespace namespace;
        private Boolean allowMulti;
        private String backend;
        private Boolean basicQuorum;
        private Long bigVClock;
        private Function chashkeyFunction;
        private Boolean lastWriteWins;
        private Function linkWalkFunction;
        private Integer rw;
        private Integer dw;
        private Integer w;
        private Integer r;
        private Integer pr;
        private Integer pw;
        private Boolean notFoundOk;
        private Function preCommitHook;
        private Function postCommitHook;
        private Long oldVClock;
        private Long youngVClock;
        private Long smallVClock;
        private Integer nval;
        private Boolean legacySearch;
        private String searchIndex;
        private Integer hllPrecision;

        public Builder(Namespace namespace)
<span class="nc" id="L246">        {</span>
<span class="nc bnc" id="L247" title="All 2 branches missed.">            if (namespace == null)</span>
            {
<span class="nc" id="L249">                throw new IllegalArgumentException(&quot;Namespace cannot be null&quot;);</span>
            }
<span class="nc" id="L251">            this.namespace = namespace;</span>
<span class="nc" id="L252">        }</span>

        /**
         * Set the allow_multi value.
         *
         * @param allow whether to allow sibling objects to be created.
         * @return a reference to this object.
         */
        public Builder withAllowMulti(boolean allow)
        {
<span class="nc" id="L262">            this.allowMulti = allow;</span>
<span class="nc" id="L263">            return this;</span>
        }

        /**
         * Set the backend used by this bucket. Only applies when using
         * {@code riak_kv_multi_backend} in Riak.
         *
         * @param backend the name of the backend to use.
         * @return a reference to this object.
         */
        public Builder withBackend(String backend)
        {
<span class="nc bnc" id="L275" title="All 4 branches missed.">            if (null == backend || backend.length() == 0)</span>
            {
<span class="nc" id="L277">                throw new IllegalArgumentException(&quot;Backend can not be null or zero length&quot;);</span>
            }
<span class="nc" id="L279">            this.backend = backend;</span>
<span class="nc" id="L280">            return this;</span>
        }

        /**
         * Set the basic_quorum value.
         *
         * The parameter controls whether a read request should return early in
         * some fail cases. E.g. If a quorum of nodes has already returned
         * notfound/error, don't wait around for the rest.
         *
         * @param use the basic_quorum value.
         * @return a reference to this object.
         */
        public Builder withBasicQuorum(boolean use)
        {
<span class="nc" id="L295">            this.basicQuorum = use;</span>
<span class="nc" id="L296">            return this;</span>
        }

        /**
         * Set the big_vclock value.
         *
         * @param bigVClock a long representing a epoch time value.
         * @return a reference to this object.
         * @see &lt;a href=&quot;http://docs.basho.com/riak/latest/theory/concepts/Vector-Clocks/#Vector-Clock-Pruning&quot;&gt;Vector Clock Pruning&lt;/a&gt;
         */
        public Builder withBigVClock(Long bigVClock)
        {
<span class="nc" id="L308">            this.bigVClock = bigVClock;</span>
<span class="nc" id="L309">            return this;</span>
        }

        /**
         * Set the chash_keyfun value.
         *
         * @param func a Function representing the Erlang func to use.
         * @return a reference to this object.
         */
        public Builder withChashkeyFunction(Function func)
        {
<span class="nc" id="L320">            this.chashkeyFunction = func;</span>
<span class="nc" id="L321">            return this;</span>
        }

        /**
         * Set the last_write_wins value. Unless you really know what you're
         * doing, you probably do not want to set this to true.
         *
         * @param wins whether to ignore vector clocks when writing.
         * @return a reference to this object.
         */
        public Builder withLastWriteWins(boolean wins)
        {
<span class="nc" id="L333">            this.lastWriteWins = wins;</span>
<span class="nc" id="L334">            return this;</span>
        }

        /**
         * Set the linkfun value.
         *
         * @param func a Function representing the Erlang func to use.
         * @return a reference to this object.
         */
        public Builder withLinkwalkFunction(Function func)
        {
<span class="nc" id="L345">            this.linkWalkFunction = func;</span>
<span class="nc" id="L346">            return this;</span>
        }

        /**
         * Set the rw value. Individual requests (or buckets in a bucket type)
         * can override this.
         *
         * @param rw the rw value as an integer.
         * @return a reference to this object.
         */
        public Builder withRw(int rw)
        {
<span class="nc" id="L358">            this.rw = rw;</span>
<span class="nc" id="L359">            return this;</span>
        }

        /**
         * Set the dw value. Individual requests (or buckets in a bucket type)
         * can override this.
         *
         * @param dw the dw value as an integer.
         * @return a reference to this object.
         */
        public Builder withDw(int dw)
        {
<span class="nc" id="L371">            this.dw = dw;</span>
<span class="nc" id="L372">            return this;</span>
        }

        /**
         * Set the w value. Individual requests (or buckets in a bucket type)
         * can override this.
         *
         * @param w the w value as an integer.
         * @return a reference to this object.
         */
        public Builder withW(int w)
        {
<span class="nc" id="L384">            this.w = w;</span>
<span class="nc" id="L385">            return this;</span>
        }

        /**
         * Set the r value. Individual requests (or buckets in a bucket type)
         * can override this.
         *
         * @param r the r value as an integer.
         * @return a reference to this object.
         */
        public Builder withR(int r)
        {
<span class="nc" id="L397">            this.r = r;</span>
<span class="nc" id="L398">            return this;</span>
        }

        /**
         * Set the pr value. Individual requests (or buckets in a bucket type)
         * can override this.
         *
         * @param pr the pr value as an integer.
         * @return a reference to this object.
         */
        public Builder withPr(int pr)
        {
<span class="nc" id="L410">            this.pr = pr;</span>
<span class="nc" id="L411">            return this;</span>
        }

        /**
         * Set the pw value. Individual requests (or buckets in a bucket type)
         * can override this.
         *
         * @param pw the pw value as an integer.
         * @return a reference to this object.
         */
        public Builder withPw(int pw)
        {
<span class="nc" id="L423">            this.pw = pw;</span>
<span class="nc" id="L424">            return this;</span>
        }

        /**
         * Set the not_found_ok value. If true a vnode returning notfound for a
         * key increments the r tally. False is higher consistency, true is
         * higher availability.
         *
         * @param ok the not_found_ok value.
         * @return a reference to this object.
         */
        public Builder withNotFoundOk(boolean ok)
        {
<span class="nc" id="L437">            this.notFoundOk = ok;</span>
<span class="nc" id="L438">            return this;</span>
        }

        /**
         * Add a pre-commit hook. The supplied Function must be an Erlang or
         * Named JS function.
         *
         * @param hook the Function to add.
         * @return a reference to this object.
         * @see &lt;a href=&quot;http://docs.basho.com/riak/latest/dev/using/commit-hooks/&quot;&gt;Using Commit Hooks&lt;/a&gt;
         */
        public Builder withPrecommitHook(Function hook)
        {
<span class="nc bnc" id="L451" title="All 6 branches missed.">            if (null == hook || !(!hook.isJavascript() || hook.isNamed()))</span>
            {
<span class="nc" id="L453">                throw new IllegalArgumentException(&quot;Must be a named JS or Erlang function.&quot;);</span>
            }
<span class="nc" id="L455">            this.preCommitHook = hook;</span>
<span class="nc" id="L456">            return this;</span>
        }

        /**
         * Add a post-commit hook. The supplied Function must be an Erlang or
         * Named JS function.
         *
         * @param hook the Function to add.
         * @return a reference to this object.
         * @see &lt;a href=&quot;http://docs.basho.com/riak/latest/dev/using/commit-hooks/&quot;&gt;Using Commit Hooks&lt;/a&gt;
         */
        public Builder withPostcommitHook(Function hook)
        {
<span class="nc" id="L469">            this.postCommitHook = hook;</span>
<span class="nc" id="L470">            return this;</span>
        }

        /**
         * Set the old_vclock value.
         *
         * @param oldVClock an long representing a epoch time value.
         * @return a reference to this object.
         * @see &lt;a href=&quot;http://docs.basho.com/riak/latest/theory/concepts/Vector-Clocks/#Vector-Clock-Pruning&quot;&gt;Vector Clock Pruning&lt;/a&gt;
         */
        public Builder withOldVClock(Long oldVClock)
        {
<span class="nc" id="L482">            this.oldVClock = oldVClock;</span>
<span class="nc" id="L483">            return this;</span>
        }

        /**
         * Set the young_vclock value.
         *
         * @param youngVClock a long representing a epoch time value.
         * @return a reference to this object.
         * @see &lt;a href=&quot;http://docs.basho.com/riak/latest/theory/concepts/Vector-Clocks/#Vector-Clock-Pruning&quot;&gt;Vector Clock Pruning&lt;/a&gt;
         */
        public Builder withYoungVClock(Long youngVClock)
        {
<span class="nc" id="L495">            this.youngVClock = youngVClock;</span>
<span class="nc" id="L496">            return this;</span>
        }

        /**
         * Set the small_vclock value.
         *
         * @param smallVClock a long representing a epoch time value.
         * @return a reference to this object.
         * @see &lt;a href=&quot;http://docs.basho.com/riak/latest/theory/concepts/Vector-Clocks/#Vector-Clock-Pruning&quot;&gt;Vector Clock Pruning&lt;/a&gt;
         */
        public Builder withSmallVClock(Long smallVClock)
        {
<span class="nc" id="L508">            this.smallVClock = smallVClock;</span>
<span class="nc" id="L509">            return this;</span>
        }

        /**
         * Set the nVal.
         *
         * @param nVal the number of replicas.
         * @return a reference to this object.
         */
        public Builder withNVal(int nVal)
        {
<span class="nc bnc" id="L520" title="All 2 branches missed.">            if (nVal &lt;= 0)</span>
            {
<span class="nc" id="L522">                throw new IllegalArgumentException(&quot;nVal must be &gt;= 1&quot;);</span>
            }
<span class="nc" id="L524">            this.nval = nVal;</span>
<span class="nc" id="L525">            return this;</span>
        }

        /**
         * Enable Legacy Riak Search. Setting this to true causes the search
         * pre-commit hook to be added.
         *
         * &lt;b&gt;Note this is only for legacy Riak (&amp;lt; v2.0) Search support.&lt;/b&gt;
         *
         * @param enable add/remove (true/false) the pre-commit hook for Legacy
         * Riak Search.
         * @return a reference to this object.
         */
        public Builder withLegacyRiakSearchEnabled(boolean enable)
        {
<span class="nc" id="L540">            this.legacySearch = enable;</span>
<span class="nc" id="L541">            return this;</span>
        }

        /**
         * Associate a Search Index. This only applies if Yokozuna is enabled in
         * Riak v2.0.
         *
         * @param indexName The name of the search index to use.
         * @return a reference to this object.
         */
        public Builder withSearchIndex(String indexName)
        {
<span class="nc bnc" id="L553" title="All 4 branches missed.">            if (null == indexName || indexName.length() == 0)</span>
            {
<span class="nc" id="L555">                throw new IllegalArgumentException(&quot;Index name cannot be null or zero length&quot;);</span>
            }
<span class="nc" id="L557">            this.searchIndex = indexName;</span>
<span class="nc" id="L558">            return this;</span>
        }

        /**
         * Set the HyperLogLog Precision.
         *
         * @param precision the number of bits to use in the HyperLogLog precision.
         *                  Valid values are [4 - 16] inclusive, default is 14 on new buckets.
         *                  &lt;b&gt;NOTE:&lt;/b&gt; When changing precision, it may only be reduced from
         *                  it's current value, and never increased.
         * @return a reference to this object.
         */
        public Builder withHllPrecision(int precision)
        {
<span class="nc bnc" id="L572" title="All 4 branches missed.">            if (precision &lt; 4 || precision &gt; 16)</span>
            {
<span class="nc" id="L574">                throw new IllegalArgumentException(&quot;Precision must be between 4 and 16, inclusive.&quot;);</span>
            }
<span class="nc" id="L576">            this.hllPrecision = precision;</span>
<span class="nc" id="L577">            return this;</span>
        }

        public StoreBucketProperties build()
        {
<span class="nc" id="L582">            return new StoreBucketProperties(this);</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>