<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Function.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Riak Client for Java</a> &gt; <a href="index.source.html" class="el_package">com.basho.riak.client.core.query.functions</a> &gt; <span class="el_source">Function.java</span></div><h1>Function.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2013 Basho Technologies Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.basho.riak.client.core.query.functions;

/**
 * A Function for use with bucket properties or asMap reduce.
 *
 * Instances are created via the provided static factory methods or by using the Builder.
 * @author Brian Roach &lt;roach at basho dot com&gt;
 * @since 2.0
 */
public class Function
{
    private final boolean isJavascript;

    private final String name;
    private final String bucket;
    private final String key;
    private final String source;

    private final String module;
    private final String function;

    private Function(Builder builder)
<span class="fc" id="L38">    {</span>
<span class="pc bfc" id="L39" title="All 2 branches covered.">        switch (builder.type)</span>
        {
            case NAMED_JS:
            case STORED_JS:
            case ANON_JS:
<span class="fc" id="L44">                isJavascript = true;</span>
<span class="fc" id="L45">                break;</span>
            default:
<span class="fc" id="L47">                isJavascript = false;</span>
                break;
        }

<span class="fc" id="L51">        this.name = builder.name;</span>
<span class="fc" id="L52">        this.bucket = builder.bucket;</span>
<span class="fc" id="L53">        this.key = builder.key;</span>
<span class="fc" id="L54">        this.source = builder.source;</span>
<span class="fc" id="L55">        this.module = builder.module;</span>
<span class="fc" id="L56">        this.function = builder.function;</span>
<span class="fc" id="L57">    }</span>

    /**
     * Returns whether this function is Javascript or not.
     * @return true if this is a JS function, false if Erlang.
     */
    public boolean isJavascript()
    {
<span class="fc" id="L65">        return isJavascript;</span>
    }

    // JS stuff
    /**
     * Return whether this is a named JS function or not.
     * @return true if this is a named JS function, false otherwise.
     */
    public boolean isNamed()
    {
<span class="fc bfc" id="L75" title="All 2 branches covered.">        return name != null;</span>
    }

    /**
     * Return whether this is a JS function stored as an object in Riak.
     * @return true if this is a stored JS function, false otherwise.
     */
    public boolean isStored()
    {
<span class="pc bpc" id="L84" title="1 of 2 branches missed.">        return bucket != null;</span>
    }

    /**
     * Return whether this is an anonymous JS function or not.
     * @return true if this is an anonymous JS function, false otherwise.
     */
    public boolean isAnonymous()
    {
<span class="pc bpc" id="L93" title="1 of 2 branches missed.">        return source != null;</span>
    }

    /**
     * Returns the name of this named JS function.
     * @return The name for this function or null if this is not a named JS function.
     */
    public String getName()
    {
<span class="fc" id="L102">        return name;</span>
    }

    /**
     * Returns the bucket for this stored JS function.
     * @return The bucket for this function or null if this is not a stored JS function.
     */
    public String getBucket()
    {
<span class="nc" id="L111">        return bucket;</span>
    }

    /**
     * Returns the key for this stored JS function.
     * @return The key for function or null is this is not a stored JS function.
     */
    public String getKey()
    {
<span class="nc" id="L120">        return key;</span>
    }

    /**
     * Returns the source for this anonymous JS function.
     * @return The source for this function, or null if it is not an anonymous function.
     */
    public String getSource()
    {
<span class="fc" id="L129">        return source;</span>
    }

    // Erlang
    /**
     * Returns the module for this Erlang function.
     * @return the module for this function or null if this is not an Erlang function.
     */
    public String getModule()
    {
<span class="fc" id="L139">        return module;</span>
    }

    /**
     * Returns the function for this Erlang function.
     * @return the function or null if this is not an erlang function.
     */
    public String getFunction()
    {
<span class="fc" id="L148">        return function;</span>
    }

    /**
     * Static factory method for Named Javascript Functions.
     * @param name the name of the Javascript function.
     * @return a Function representing a named JS Function.
     */
    public static Function newNamedJsFunction(String name)
    {
<span class="fc" id="L158">        return new Builder().withName(name).build();</span>
    }

    /**
     * Static factory method for Stored Javascript Functions.
     * @param bucket The bucket where the JS function is stored
     * @param key the key for the object containing the JS function
     * @return a Function representing a stored JS function.
     */
    public static Function newStoredJsFunction(String bucket, String key)
    {
<span class="nc" id="L169">        return new Builder().withBucket(bucket).withKey(key).build();</span>
    }

    /**
     * Static factory method for Anonymous JS Functions.
     * @param source the javascript source
     * @return a Function representing an anonymous JS function.
     */
    public static Function newAnonymousJsFunction(String source)
    {
<span class="fc" id="L179">        return new Builder().withSource(source).build();</span>
    }

    /**
     * Static factory method for Erlang Functions.
     * @param module the module that contains the Erlang function.
     * @param function the name of the erlang function.
     * @return a Function representing a Erlang function.
     */
    public static Function newErlangFunction(String module, String function)
    {
<span class="fc" id="L190">        return new Builder().withModule(module).withFunction(function).build();</span>
    }

    @Override
    public int hashCode()
    {
<span class="nc" id="L196">        final int prime = 31;</span>
<span class="nc" id="L197">        int result = 1;</span>
<span class="nc bnc" id="L198" title="All 2 branches missed.">        result = prime * result + (null == name ? 0 : name.hashCode());</span>
<span class="nc bnc" id="L199" title="All 2 branches missed.">        result = prime * result + (null == bucket ? 0 : bucket.hashCode());</span>
<span class="nc bnc" id="L200" title="All 2 branches missed.">        result = prime * result + (null == key ? 0 : key.hashCode());</span>
<span class="nc bnc" id="L201" title="All 2 branches missed.">        result = prime * result + (null == source ? 0 : source.hashCode());</span>
<span class="nc bnc" id="L202" title="All 2 branches missed.">        result = prime * result + (null == module ? 0 : module.hashCode());</span>
<span class="nc bnc" id="L203" title="All 2 branches missed.">        result = prime * result + (null == function ? 0 : function.hashCode());</span>
<span class="nc" id="L204">        return result;</span>
    }

    @Override
    public boolean equals(Object obj)
    {
<span class="nc bnc" id="L210" title="All 2 branches missed.">        if (this == obj)</span>
        {
<span class="nc" id="L212">            return true;</span>
        }
<span class="nc bnc" id="L214" title="All 2 branches missed.">        if (obj == null)</span>
        {
<span class="nc" id="L216">            return false;</span>
        }
<span class="nc bnc" id="L218" title="All 2 branches missed.">        if (!(obj instanceof Function))</span>
        {
<span class="nc" id="L220">            return false;</span>
        }
<span class="nc" id="L222">        Function other = (Function) obj;</span>
<span class="nc bnc" id="L223" title="All 10 branches missed.">        if ( (name == other.name || (name != null &amp;&amp; name.equals(other.name))) &amp;&amp;</span>
<span class="nc bnc" id="L224" title="All 6 branches missed.">             (bucket == other.bucket || (bucket != null &amp;&amp; bucket.equals(other.bucket))) &amp;&amp;</span>
<span class="nc bnc" id="L225" title="All 6 branches missed.">             (key == other.key || (key != null &amp;&amp; key.equals(other.key))) &amp;&amp;</span>
<span class="nc bnc" id="L226" title="All 6 branches missed.">             (source == other.source || (source != null &amp;&amp; source.equals(other.source))) &amp;&amp;</span>
<span class="nc bnc" id="L227" title="All 6 branches missed.">             (module == other.module || (module != null &amp;&amp; module.equals(other.module))) &amp;&amp;</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">             (function == other.function || (function != null &amp;&amp; function.equals(other.function)))</span>
           )
        {
<span class="nc" id="L231">            return true;</span>
        }
        else
        {
<span class="nc" id="L235">            return false;</span>
        }
    }

    /**
     * Builder class for creating Function instances.
     */
    public static class Builder
    {
<span class="pc" id="L244">        private enum Type</span>
        {
<span class="fc" id="L246">            UNKNOWN,</span>
<span class="fc" id="L247">            NAMED_JS,</span>
<span class="fc" id="L248">            STORED_JS,</span>
<span class="fc" id="L249">            ANON_JS,</span>
<span class="fc" id="L250">            ERLANG</span>
        }
<span class="fc" id="L252">        private Type type = Type.UNKNOWN;</span>

        private String name;
        private String bucket;
        private String key;
        private String source;

        private String module;
        private String function;

        public Builder()
<span class="fc" id="L263">        {</span>
<span class="fc" id="L264">        }</span>

        /**
         * Set the name for a Named Javascript function.
         * @param name the name of the function.
         * @return a reference to this builder.
         */
        public Builder withName(String name)
        {
<span class="fc" id="L273">            stringCheck(name);</span>
<span class="pc bpc" id="L274" title="1 of 2 branches missed.">            switch (type)</span>
            {
                case UNKNOWN:
                case NAMED_JS:
<span class="fc" id="L278">                    this.name = name;</span>
<span class="fc" id="L279">                    type = Type.NAMED_JS;</span>
<span class="fc" id="L280">                    break;</span>
                default:
<span class="nc" id="L282">                    throw new IllegalArgumentException(type + &quot; can not have a name.&quot;);</span>
            }

<span class="fc" id="L285">            return this;</span>
        }

        /**
         * Set the bucket for a stored JS function.
         * @param bucket the name of the bucket where this function is stored.
         * @return a reference to this builder.
         */
        public Builder withBucket(String bucket)
        {
<span class="nc" id="L295">            stringCheck(bucket);</span>
<span class="nc bnc" id="L296" title="All 2 branches missed.">            switch (type)</span>
            {
                case UNKNOWN:
                case STORED_JS:
<span class="nc" id="L300">                    this.bucket = bucket;</span>
<span class="nc" id="L301">                    type = Type.STORED_JS;</span>
<span class="nc" id="L302">                    break;</span>
                default:
<span class="nc" id="L304">                    throw new IllegalArgumentException(type + &quot; can not have a bucket.&quot;);</span>
            }

<span class="nc" id="L307">            return this;</span>
        }

        /**
         * Set the key for a stored JS function.
         * @param key the key for the object that contains the JS function.
         * @return a reference to this builder.
         */
        public Builder withKey(String key)
        {
<span class="nc" id="L317">            stringCheck(key);</span>
<span class="nc bnc" id="L318" title="All 2 branches missed.">            switch (type)</span>
            {
                case UNKNOWN:
                case STORED_JS:
<span class="nc" id="L322">                    this.key = key;</span>
<span class="nc" id="L323">                    type = Type.STORED_JS;</span>
<span class="nc" id="L324">                    break;</span>
                default:
<span class="nc" id="L326">                    throw new IllegalArgumentException(type + &quot; can not have a key.&quot;);</span>
            }
<span class="nc" id="L328">            return this;</span>
        }

        /**
         * Set the source for an anonymous JS function
         * @param source the Javascript source.
         * @return a reference to this builder.
         */
        public Builder withSource(String source)
        {
<span class="fc" id="L338">            stringCheck(source);</span>
<span class="pc bpc" id="L339" title="1 of 2 branches missed.">            switch (type)</span>
            {
                case UNKNOWN:
<span class="fc" id="L342">                    this.source = source;</span>
<span class="fc" id="L343">                    type = Type.ANON_JS;</span>
<span class="fc" id="L344">                    break;</span>
                default:
<span class="nc" id="L346">                    throw new IllegalArgumentException(type + &quot; can not have a source.&quot;);</span>
            }
<span class="fc" id="L348">            return this;</span>
        }

        /**
         * Set the module for an Erlang function.
         * @param module the name of the module containing the Erlang function.
         * @return a reference to this builder.
         */
        public Builder withModule(String module)
        {
<span class="fc" id="L358">            stringCheck(module);</span>
<span class="pc bpc" id="L359" title="1 of 2 branches missed.">            switch (type)</span>
            {
                case UNKNOWN:
                case ERLANG:
<span class="fc" id="L363">                    this.module = module;</span>
<span class="fc" id="L364">                    type = Type.ERLANG;</span>
<span class="fc" id="L365">                    break;</span>
                default:
<span class="nc" id="L367">                    throw new IllegalArgumentException(type + &quot; can not have a module.&quot;);</span>
            }
<span class="fc" id="L369">            return this;</span>
        }

        /**
         * Set the function name for an Erlang function.
         * @param function the name of the Erlang function.
         * @return a reference to this builder.
         */
        public Builder withFunction(String function)
        {
<span class="fc" id="L379">            stringCheck(function);</span>
<span class="pc bpc" id="L380" title="1 of 2 branches missed.">            switch (type)</span>
            {
                case UNKNOWN:
                case ERLANG:
<span class="fc" id="L384">                    this.function = function;</span>
<span class="fc" id="L385">                    type = Type.ERLANG;</span>
<span class="fc" id="L386">                    break;</span>
                default:
<span class="nc" id="L388">                    throw new IllegalArgumentException(type + &quot; can not have a function.&quot;);</span>
            }
<span class="fc" id="L390">            return this;</span>
        }

        private void stringCheck(String arg)
        {
<span class="pc bpc" id="L395" title="2 of 4 branches missed.">            if (null == arg || arg.length() == 0)</span>
            {
<span class="nc" id="L397">                throw new IllegalArgumentException(&quot;String can not be null or zero length.&quot;);</span>
            }
<span class="fc" id="L399">        }</span>

        /**
         * Construct and return a Function.
         * @return a Function
         */
        public Function build()
        {
<span class="pc bpc" id="L407" title="2 of 4 branches missed.">            switch (type)</span>
            {
                case UNKNOWN:
<span class="nc" id="L410">                    throw new IllegalStateException(&quot;Nothing to build.&quot;);</span>
                case STORED_JS:
<span class="nc bnc" id="L412" title="All 4 branches missed.">                    if (null == bucket || null == key)</span>
                    {
<span class="nc" id="L414">                        throw new IllegalArgumentException(&quot;Stored Javascript requires both a bucket and key&quot;);</span>
                    }
                    break;
                case ERLANG:
<span class="pc bpc" id="L418" title="2 of 4 branches missed.">                    if (null == module || null == function)</span>
                    {
<span class="nc" id="L420">                        throw new IllegalArgumentException(&quot;Erlang requires both a module and a function&quot;);</span>
                    }
                    break;
                default:
                    break;
            }

<span class="fc" id="L427">            return new Function(this);</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>