<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BucketPropertiesConverter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Riak Client for Java</a> &gt; <a href="index.source.html" class="el_package">com.basho.riak.client.core.converters</a> &gt; <span class="el_source">BucketPropertiesConverter.java</span></div><h1>BucketPropertiesConverter.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2013 Brian Roach &lt;roach at basho dot com&gt;.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package com.basho.riak.client.core.converters;

import com.basho.riak.client.core.operations.Operations;
import com.basho.riak.client.core.query.BucketProperties;
import com.basho.riak.client.core.query.functions.Function;
import com.basho.riak.protobuf.RiakPB;
import com.google.protobuf.ByteString;
import java.util.ArrayList;
import java.util.List;

/**
 *
 * @author Brian Roach &lt;roach at basho dot com&gt;
 */
public class BucketPropertiesConverter
{
<span class="nc" id="L33">    private BucketPropertiesConverter() {}</span>

    public static BucketProperties convert(RiakPB.RpbBucketProps pbProps)
    {
<span class="nc" id="L37">        BucketProperties.Builder builder = new BucketProperties.Builder()</span>
<span class="nc" id="L38">            .withNVal(pbProps.getNVal())</span>
<span class="nc" id="L39">            .withAllowMulti(pbProps.getAllowMult())</span>
<span class="nc" id="L40">            .withLastWriteWins(pbProps.getLastWriteWins())</span>
<span class="nc" id="L41">            .withOldVClock(Operations.getUnsignedIntValue(pbProps.getOldVclock()))</span>
<span class="nc" id="L42">            .withYoungVClock(Operations.getUnsignedIntValue(pbProps.getYoungVclock()))</span>
<span class="nc" id="L43">            .withBigVClock(Operations.getUnsignedIntValue(pbProps.getBigVclock()))</span>
<span class="nc" id="L44">            .withSmallVClock(Operations.getUnsignedIntValue(pbProps.getSmallVclock()))</span>
<span class="nc" id="L45">            .withPr(pbProps.getPr())</span>
<span class="nc" id="L46">            .withR(pbProps.getR())</span>
<span class="nc" id="L47">            .withW(pbProps.getW())</span>
<span class="nc" id="L48">            .withPw(pbProps.getPw())</span>
<span class="nc" id="L49">            .withDw(pbProps.getDw())</span>
<span class="nc" id="L50">            .withRw(pbProps.getRw())</span>
<span class="nc" id="L51">            .withBasicQuorum(pbProps.getBasicQuorum())</span>
<span class="nc" id="L52">            .withNotFoundOk(pbProps.getNotfoundOk())</span>
<span class="nc" id="L53">            .withLegacyRiakSearchEnabled(pbProps.getSearch())</span>
<span class="nc" id="L54">            .withChashkeyFunction(</span>
                new Function.Builder()
<span class="nc" id="L56">                    .withModule(pbProps.getChashKeyfun().getModule().toStringUtf8())</span>
<span class="nc" id="L57">                    .withFunction(pbProps.getChashKeyfun().getFunction().toStringUtf8())</span>
<span class="nc" id="L58">                    .build());</span>

<span class="nc bnc" id="L60" title="All 2 branches missed.">            if (pbProps.hasLinkfun())</span>
            {
<span class="nc" id="L62">                builder.withLinkwalkFunction(</span>
                new Function.Builder()
<span class="nc" id="L64">                    .withModule(pbProps.getLinkfun().getModule().toStringUtf8())</span>
<span class="nc" id="L65">                    .withFunction(pbProps.getLinkfun().getFunction().toStringUtf8())</span>
<span class="nc" id="L66">                    .build());</span>
            }

<span class="nc bnc" id="L69" title="All 2 branches missed.">            if (pbProps.hasHasPrecommit())</span>
            {
<span class="nc bnc" id="L71" title="All 2 branches missed.">                for (Function f : parseHooks(pbProps.getPrecommitList()))</span>
                {
<span class="nc" id="L73">                    builder.withPrecommitHook(f);</span>
<span class="nc" id="L74">                }</span>
            }

<span class="nc bnc" id="L77" title="All 2 branches missed.">            if (pbProps.hasHasPostcommit())</span>
            {
<span class="nc bnc" id="L79" title="All 2 branches missed.">                for (Function f : parseHooks(pbProps.getPostcommitList()))</span>
                {
<span class="nc" id="L81">                    builder.withPostcommitHook(f);</span>
<span class="nc" id="L82">                }</span>
            }

<span class="nc bnc" id="L85" title="All 2 branches missed.">            if (pbProps.hasSearchIndex())</span>
            {
<span class="nc" id="L87">                builder.withSearchIndex(pbProps.getSearchIndex().toStringUtf8());</span>
            }

<span class="nc bnc" id="L90" title="All 2 branches missed.">            if (pbProps.hasBackend())</span>
            {
<span class="nc" id="L92">                builder.withBackend(pbProps.getBackend().toStringUtf8());</span>
            }

<span class="nc bnc" id="L95" title="All 2 branches missed.">            if (pbProps.hasHllPrecision())</span>
            {
<span class="nc" id="L97">                builder.withHllPrecision(pbProps.getHllPrecision());</span>
            }

<span class="nc" id="L100">            return builder.build();</span>
    }

    public static RiakPB.RpbBucketProps convert(BucketProperties bucketProperties)
    {
        RiakPB.RpbBucketProps.Builder propsBuilder =
<span class="nc" id="L106">            RiakPB.RpbBucketProps.newBuilder();</span>

<span class="nc bnc" id="L108" title="All 2 branches missed.">        if (bucketProperties.hasNVal())</span>
        {
<span class="nc" id="L110">            propsBuilder.setNVal(bucketProperties.getNVal());</span>
        }
<span class="nc bnc" id="L112" title="All 2 branches missed.">        if (bucketProperties.hasAllowMulti())</span>
        {
<span class="nc" id="L114">            propsBuilder.setAllowMult(bucketProperties.getAllowMulti());</span>
        }
<span class="nc bnc" id="L116" title="All 2 branches missed.">        if (bucketProperties.hasLastWriteWins())</span>
        {
<span class="nc" id="L118">            propsBuilder.setLastWriteWins(bucketProperties.getLastWriteWins());</span>
        }
<span class="nc bnc" id="L120" title="All 2 branches missed.">        if (bucketProperties.hasPrecommitHooks())</span>
        {
<span class="nc" id="L122">            propsBuilder.addAllPrecommit(convertHooks(bucketProperties.getPrecommitHooks()));</span>
        }
<span class="nc bnc" id="L124" title="All 2 branches missed.">        if (bucketProperties.hasPostcommitHooks())</span>
        {
<span class="nc" id="L126">            propsBuilder.addAllPostcommit(convertHooks(bucketProperties.getPostcommitHooks()));</span>
        }
<span class="nc bnc" id="L128" title="All 2 branches missed.">        if (bucketProperties.hasChashKeyFunction())</span>
        {
<span class="nc" id="L130">            propsBuilder.setChashKeyfun(convertModFun(bucketProperties.getChashKeyFunction()));</span>
        }
<span class="nc bnc" id="L132" title="All 2 branches missed.">        if (bucketProperties.hasLinkwalkFunction())</span>
        {
<span class="nc" id="L134">            propsBuilder.setLinkfun(convertModFun(bucketProperties.getLinkwalkFunction()));</span>
        }
<span class="nc bnc" id="L136" title="All 2 branches missed.">        if (bucketProperties.hasOldVClock())</span>
        {
<span class="nc" id="L138">            propsBuilder.setOldVclock(bucketProperties.getOldVClock().intValue());</span>
        }
<span class="nc bnc" id="L140" title="All 2 branches missed.">        if (bucketProperties.hasYoungVClock())</span>
        {
<span class="nc" id="L142">            propsBuilder.setYoungVclock(bucketProperties.getYoungVClock().intValue());</span>
        }
<span class="nc bnc" id="L144" title="All 2 branches missed.">        if (bucketProperties.hasBigVClock())</span>
        {
<span class="nc" id="L146">            propsBuilder.setBigVclock(bucketProperties.getBigVClock().intValue());</span>
        }
<span class="nc bnc" id="L148" title="All 2 branches missed.">        if (bucketProperties.hasSmallVClock())</span>
        {
<span class="nc" id="L150">            propsBuilder.setSmallVclock(bucketProperties.getSmallVClock().intValue());</span>
        }
<span class="nc bnc" id="L152" title="All 2 branches missed.">        if (bucketProperties.hasPr())</span>
        {
<span class="nc" id="L154">            propsBuilder.setPr(bucketProperties.getPr().getIntValue());</span>
        }
<span class="nc bnc" id="L156" title="All 2 branches missed.">        if (bucketProperties.hasR())</span>
        {
<span class="nc" id="L158">            propsBuilder.setR(bucketProperties.getR().getIntValue());</span>
        }
<span class="nc bnc" id="L160" title="All 2 branches missed.">        if (bucketProperties.hasW())</span>
        {
<span class="nc" id="L162">            propsBuilder.setW(bucketProperties.getW().getIntValue());</span>
        }
<span class="nc bnc" id="L164" title="All 2 branches missed.">        if (bucketProperties.hasPw())</span>
        {
<span class="nc" id="L166">            propsBuilder.setPw(bucketProperties.getPw().getIntValue());</span>
        }
<span class="nc bnc" id="L168" title="All 2 branches missed.">        if (bucketProperties.hasDw())</span>
        {
<span class="nc" id="L170">            propsBuilder.setDw(bucketProperties.getDw().getIntValue());</span>
        }
<span class="nc bnc" id="L172" title="All 2 branches missed.">        if (bucketProperties.hasRw())</span>
        {
<span class="nc" id="L174">            propsBuilder.setRw(bucketProperties.getRw().getIntValue());</span>
        }
<span class="nc bnc" id="L176" title="All 2 branches missed.">        if (bucketProperties.hasBasicQuorum())</span>
        {
<span class="nc" id="L178">            propsBuilder.setBasicQuorum(bucketProperties.getBasicQuorum());</span>
        }
<span class="nc bnc" id="L180" title="All 2 branches missed.">        if (bucketProperties.hasNotFoundOk())</span>
        {
<span class="nc" id="L182">            propsBuilder.setNotfoundOk(bucketProperties.getNotFoundOk());</span>
        }
<span class="nc bnc" id="L184" title="All 2 branches missed.">        if (bucketProperties.hasBackend())</span>
        {
<span class="nc" id="L186">            propsBuilder.setBackend(ByteString.copyFromUtf8(bucketProperties.getBackend()));</span>
        }
<span class="nc bnc" id="L188" title="All 2 branches missed.">        if (bucketProperties.hasLegacyRiakSearchEnabled())</span>
        {
<span class="nc" id="L190">            propsBuilder.setSearch(bucketProperties.getLegacyRiakSearchEnabled());</span>
        }
<span class="nc bnc" id="L192" title="All 2 branches missed.">        if (bucketProperties.hasSearchIndex())</span>
        {
<span class="nc" id="L194">            propsBuilder.setSearchIndex(ByteString.copyFromUtf8(bucketProperties.getSearchIndex()));</span>
        }
<span class="nc bnc" id="L196" title="All 2 branches missed.">        if (bucketProperties.hasHllPrecision())</span>
        {
<span class="nc" id="L198">            propsBuilder.setHllPrecision(bucketProperties.getHllPrecision());</span>
        }

<span class="nc" id="L201">        return propsBuilder.build();</span>
    }

    private static List&lt;Function&gt; parseHooks(List&lt;RiakPB.RpbCommitHook&gt; hooks)
    {
<span class="nc" id="L206">        List&lt;Function&gt; list = new ArrayList&lt;&gt;(hooks.size());</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">        for ( RiakPB.RpbCommitHook hook : hooks)</span>
        {
<span class="nc bnc" id="L209" title="All 2 branches missed.">            if (hook.hasName())</span>
            {
<span class="nc" id="L211">                Function f =</span>
                    new Function.Builder()
<span class="nc" id="L213">                        .withName(hook.getName().toStringUtf8())</span>
<span class="nc" id="L214">                        .build();</span>
<span class="nc" id="L215">                list.add(f);</span>
<span class="nc" id="L216">            }</span>
            else
            {
<span class="nc" id="L219">                Function f = new Function.Builder()</span>
<span class="nc" id="L220">                    .withModule(hook.getModfun().getModule().toStringUtf8())</span>
<span class="nc" id="L221">                    .withFunction(hook.getModfun().getFunction().toStringUtf8())</span>
<span class="nc" id="L222">                    .build();</span>
<span class="nc" id="L223">                list.add(f);</span>
            }
<span class="nc" id="L225">        }</span>
<span class="nc" id="L226">        return list;</span>
    }

    private static RiakPB.RpbModFun convertModFun(Function f)
    {
<span class="nc" id="L231">        return RiakPB.RpbModFun.newBuilder()</span>
<span class="nc" id="L232">                    .setModule(ByteString.copyFromUtf8(f.getModule()))</span>
<span class="nc" id="L233">                    .setFunction(ByteString.copyFromUtf8(f.getFunction()))</span>
<span class="nc" id="L234">                    .build();</span>
    }

    private static List&lt;RiakPB.RpbCommitHook&gt; convertHooks(List&lt;Function&gt; hookList)
    {
<span class="nc" id="L239">        List&lt;RiakPB.RpbCommitHook&gt; pbHookList = new ArrayList&lt;&gt;(hookList.size());</span>
<span class="nc" id="L240">        RiakPB.RpbCommitHook.Builder builder = RiakPB.RpbCommitHook.newBuilder();</span>
<span class="nc" id="L241">        RiakPB.RpbModFun.Builder mfBuilder = RiakPB.RpbModFun.newBuilder();</span>
<span class="nc bnc" id="L242" title="All 2 branches missed.">        for (Function hook : hookList)</span>
        {
<span class="nc bnc" id="L244" title="All 2 branches missed.">            if (hook.isJavascript())</span>
            {
<span class="nc" id="L246">                builder.setName(ByteString.copyFromUtf8(hook.getName()));</span>
            }
            else
            {
<span class="nc" id="L250">                mfBuilder.setModule(ByteString.copyFromUtf8(hook.getModule()));</span>
<span class="nc" id="L251">                mfBuilder.setFunction(ByteString.copyFromUtf8(hook.getFunction()));</span>
<span class="nc" id="L252">                builder.setModfun(mfBuilder);</span>
            }

<span class="nc" id="L255">            pbHookList.add(builder.build());</span>
<span class="nc" id="L256">            builder.clear();</span>
<span class="nc" id="L257">            mfBuilder.clear();</span>
<span class="nc" id="L258">        }</span>
<span class="nc" id="L259">        return pbHookList;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>