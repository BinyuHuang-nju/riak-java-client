<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AnnotationScanner.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Riak Client for Java</a> &gt; <a href="index.source.html" class="el_package">com.basho.riak.client.api.convert.reflection</a> &gt; <span class="el_source">AnnotationScanner.java</span></div><h1>AnnotationScanner.java</h1><pre class="source lang-java linenums">/*
 * This file is provided to you under the Apache License, Version 2.0 (the
 * &quot;License&quot;); you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License.
 */
package com.basho.riak.client.api.convert.reflection;

import com.basho.riak.client.api.annotations.RiakBucketName;
import com.basho.riak.client.api.annotations.RiakBucketType;
import com.basho.riak.client.api.annotations.RiakContentType;
import java.lang.reflect.Field;
import java.lang.reflect.Method;
import java.util.concurrent.Callable;

import com.basho.riak.client.api.annotations.RiakIndex;
import com.basho.riak.client.api.annotations.RiakKey;
import com.basho.riak.client.api.annotations.RiakLastModified;
import com.basho.riak.client.api.annotations.RiakLinks;
import com.basho.riak.client.api.annotations.RiakTombstone;
import com.basho.riak.client.api.annotations.RiakUsermeta;
import com.basho.riak.client.api.annotations.RiakVClock;
import com.basho.riak.client.api.annotations.RiakVTag;
import java.util.LinkedList;

/**
 * A {@link Callable} that loops over a classes fields and pulls out the fields
 * for {@link RiakUsermeta} and {@link RiakKey}
 *
 * @author russell
 *
 */
public class AnnotationScanner implements Callable&lt;AnnotationInfo&gt;
{
    @SuppressWarnings(&quot;rawtypes&quot;)
    private final Class classToScan;

    @SuppressWarnings(&quot;rawtypes&quot;)
    public AnnotationScanner(Class clazz)
<span class="fc" id="L47">    {</span>
<span class="fc" id="L48">        this.classToScan = clazz;</span>
<span class="fc" id="L49">    }</span>

    @Override
    public AnnotationInfo call() throws Exception
    {
<span class="fc" id="L54">        AnnotationInfo.Builder builder = new AnnotationInfo.Builder();</span>

        // This allows us to start at the top and walk down so that
        // annotations are overridden in subsclasses
<span class="fc" id="L58">        LinkedList&lt;Class&gt; classList = new LinkedList&lt;&gt;();</span>
<span class="fc" id="L59">        Class currentClass = classToScan;</span>
<span class="fc bfc" id="L60" title="All 2 branches covered.">        while (currentClass != Object.class)</span>
        {
<span class="fc" id="L62">            classList.addFirst(currentClass);</span>
<span class="fc" id="L63">            currentClass = currentClass.getSuperclass();</span>
        }

<span class="fc bfc" id="L66" title="All 2 branches covered.">        for (Class c : classList)</span>
        {
<span class="fc" id="L68">            final Field[] fields = c.getDeclaredFields();</span>

<span class="fc bfc" id="L70" title="All 2 branches covered.">            for (Field field : fields)</span>
            {
<span class="fc bfc" id="L72" title="All 2 branches covered.">                if (field.isAnnotationPresent(RiakKey.class))</span>
                {
<span class="fc" id="L74">                    builder.withRiakKeyField(field);</span>
                }
<span class="fc bfc" id="L76" title="All 2 branches covered.">                else if (field.isAnnotationPresent(RiakVClock.class))</span>
                {
<span class="fc" id="L78">                    builder.withRiakVClockField(field);</span>
                }
<span class="fc bfc" id="L80" title="All 2 branches covered.">                else if (field.isAnnotationPresent(RiakTombstone.class))</span>
                {
<span class="fc" id="L82">                    builder.withRiakTombstoneField(field);</span>
                }
<span class="fc bfc" id="L84" title="All 2 branches covered.">                else if (field.isAnnotationPresent(RiakUsermeta.class))</span>
                {
<span class="fc" id="L86">                    builder.addRiakUsermetaField(field);</span>
                }
<span class="fc bfc" id="L88" title="All 2 branches covered.">                else if (field.isAnnotationPresent(RiakIndex.class))</span>
                {
<span class="fc" id="L90">                    builder.addRiakIndexField(field);</span>
                }
<span class="fc bfc" id="L92" title="All 2 branches covered.">                else if (field.isAnnotationPresent(RiakLinks.class))</span>
                {
<span class="fc" id="L94">                    builder.withRiakLinksField(field);</span>
                }
<span class="fc bfc" id="L96" title="All 2 branches covered.">                else if (field.isAnnotationPresent(RiakContentType.class))</span>
                {
<span class="fc" id="L98">                    builder.withRiakContentTypeField(field);</span>
                }
<span class="fc bfc" id="L100" title="All 2 branches covered.">                else if (field.isAnnotationPresent(RiakLastModified.class))</span>
                {
<span class="fc" id="L102">                    builder.withRiakLastModifiedField(field);</span>
                }
<span class="fc bfc" id="L104" title="All 2 branches covered.">                else if (field.isAnnotationPresent(RiakVTag.class))</span>
                {
<span class="fc" id="L106">                    builder.withRiakVTagField(field);</span>
                }
<span class="fc bfc" id="L108" title="All 2 branches covered.">                else if (field.isAnnotationPresent(RiakBucketName.class))</span>
                {
<span class="fc" id="L110">                    builder.withRiakBucketNameField(field);</span>
                }
<span class="fc bfc" id="L112" title="All 2 branches covered.">                else if (field.isAnnotationPresent(RiakBucketType.class))</span>
                {
<span class="fc" id="L114">                    builder.withRiakBucketTypeField(field);</span>
                }
            }

<span class="fc" id="L118">            final Method[] methods = c.getDeclaredMethods();</span>
<span class="fc bfc" id="L119" title="All 2 branches covered.">            for (Method method : methods)</span>
            {
<span class="fc bfc" id="L121" title="All 2 branches covered.">                if (method.isAnnotationPresent(RiakKey.class))</span>
                {
<span class="fc bfc" id="L123" title="All 2 branches covered.">                    if (isSetter(method))</span>
                    {
<span class="fc" id="L125">                        builder.withRiakKeySetter(method);</span>
                    }
                    else
                    {
<span class="fc" id="L129">                        builder.withRiakKeyGetter(method);</span>
                    }
                }
<span class="fc bfc" id="L132" title="All 2 branches covered.">                else if (method.isAnnotationPresent(RiakBucketName.class))</span>
                {
<span class="fc bfc" id="L134" title="All 2 branches covered.">                    if (isSetter(method))</span>
                    {
<span class="fc" id="L136">                        builder.withRiakBucketNameSetter(method);</span>
                    }
                    else
                    {
<span class="fc" id="L140">                        builder.withRiakBucketNameGetter(method);</span>
                    }
                }
<span class="fc bfc" id="L143" title="All 2 branches covered.">                else if (method.isAnnotationPresent(RiakBucketType.class))</span>
                {
<span class="fc bfc" id="L145" title="All 2 branches covered.">                    if (isSetter(method))</span>
                    {
<span class="fc" id="L147">                        builder.withRiakBucketTypeSetter(method);</span>
                    }
                    else
                    {
<span class="fc" id="L151">                        builder.withRiakBucketTypeGetter(method);</span>
                    }
                }
<span class="fc bfc" id="L154" title="All 2 branches covered.">                else if (method.isAnnotationPresent(RiakLinks.class))</span>
                {
<span class="fc bfc" id="L156" title="All 2 branches covered.">                    if (isSetter(method))</span>
                    {
<span class="fc" id="L158">                        builder.withRiakLinksSetter(method);</span>
                    }
                    else
                    {
<span class="fc" id="L162">                        builder.withRiakLinksGetter(method);</span>
                    }
                }
<span class="fc bfc" id="L165" title="All 2 branches covered.">                else if (method.isAnnotationPresent(RiakVClock.class))</span>
                {
<span class="fc bfc" id="L167" title="All 2 branches covered.">                    if (isSetter(method))</span>
                    {
<span class="fc" id="L169">                        builder.withRiakVClockSetter(method);</span>
                    }
                    else
                    {
<span class="fc" id="L173">                        builder.withRiakVClockGetter(method);</span>
                    }
                }
<span class="fc bfc" id="L176" title="All 2 branches covered.">                else if (method.isAnnotationPresent(RiakTombstone.class))</span>
                {
<span class="fc bfc" id="L178" title="All 2 branches covered.">                    if (isSetter(method))</span>
                    {
<span class="fc" id="L180">                        builder.withRiakTombstoneSetter(method);</span>
                    }
                    else
                    {
<span class="fc" id="L184">                        builder.withRiakTombstoneGetter(method);</span>
                    }
                }
<span class="fc bfc" id="L187" title="All 2 branches covered.">                else if (method.isAnnotationPresent(RiakContentType.class))</span>
                {
<span class="fc bfc" id="L189" title="All 2 branches covered.">                    if (isSetter(method))</span>
                    {
<span class="fc" id="L191">                        builder.withRiakContentTypeSetter(method);</span>
                    }
                    else
                    {
<span class="fc" id="L195">                        builder.withRiakContentTypeGetter(method);</span>
                    }
                }
<span class="fc bfc" id="L198" title="All 2 branches covered.">                else if (method.isAnnotationPresent(RiakVTag.class))</span>
                {
<span class="pc bpc" id="L200" title="1 of 2 branches missed.">                    if (isSetter(method))</span>
                    {
<span class="fc" id="L202">                        builder.withRiakVTagSetter(method);</span>
                    }
                    else
                    {
<span class="nc" id="L206">                        throw new IllegalArgumentException(&quot;@RiakVTag annotated getter not supported&quot;);</span>
                    }
                }
<span class="fc bfc" id="L209" title="All 2 branches covered.">                else if (method.isAnnotationPresent(RiakLastModified.class))</span>
                {
<span class="pc bpc" id="L211" title="1 of 2 branches missed.">                    if (isSetter(method))</span>
                    {
<span class="fc" id="L213">                        builder.withRiakLastModifiedSetter(method);</span>
                    }
                    else
                    {
<span class="nc" id="L217">                        throw new IllegalArgumentException(&quot;@RiakLastModified annotated getter not supported&quot;);</span>
                    }
                }
<span class="fc bfc" id="L220" title="All 2 branches covered.">                else if (method.isAnnotationPresent(RiakIndex.class))</span>
                {
<span class="fc" id="L222">                    builder.addRiakIndexMethod(method);</span>
                }
<span class="fc bfc" id="L224" title="All 2 branches covered.">                else if (method.isAnnotationPresent(RiakUsermeta.class))</span>
                {
<span class="fc" id="L226">                    builder.addRiakUsermetaMethod(method);</span>
                }
            }
<span class="fc" id="L229">        }</span>

<span class="fc" id="L231">        return builder.build();</span>
    }

    private boolean isSetter(Method m)
    {
<span class="fc" id="L236">        return m.getReturnType().equals(Void.TYPE);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>