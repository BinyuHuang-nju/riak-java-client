<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RiakBeanSerializerModifier.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Riak Client for Java</a> &gt; <a href="index.source.html" class="el_package">com.basho.riak.client.api.convert</a> &gt; <span class="el_source">RiakBeanSerializerModifier.java</span></div><h1>RiakBeanSerializerModifier.java</h1><pre class="source lang-java linenums">/*
 * This file is provided to you under the Apache License, Version 2.0 (the
 * &quot;License&quot;); you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License.
 */
package com.basho.riak.client.api.convert;

import com.basho.riak.client.api.annotations.RiakBucketName;
import com.basho.riak.client.api.annotations.RiakBucketType;
import com.basho.riak.client.api.annotations.RiakContentType;
import com.basho.riak.client.api.annotations.RiakKey;
import com.basho.riak.client.api.annotations.RiakLinks;
import com.basho.riak.client.api.annotations.RiakUsermeta;
import com.basho.riak.client.api.annotations.RiakVClock;
import com.basho.riak.client.api.annotations.RiakIndex;
import com.basho.riak.client.api.annotations.RiakLastModified;
import com.basho.riak.client.api.annotations.RiakTombstone;
import com.basho.riak.client.api.annotations.RiakVTag;
import com.fasterxml.jackson.annotation.JsonProperty;
import com.fasterxml.jackson.databind.BeanDescription;
import com.fasterxml.jackson.databind.SerializationConfig;
import com.fasterxml.jackson.databind.ser.BeanPropertyWriter;
import com.fasterxml.jackson.databind.ser.BeanSerializerModifier;

import java.lang.annotation.Annotation;
import java.util.ArrayList;
import java.util.List;

/**
 * {@link BeanSerializerModifier} that drops {@link RiakKey} and
 * {@link RiakUsermeta} annotated fields from the the set of fields that Jackson
 * will serialize
 *
 * @author russell
 *
 */
public class RiakBeanSerializerModifier extends BeanSerializerModifier
{
<span class="fc" id="L47">    private static final RiakBeanSerializerModifier INSTANCE = new RiakBeanSerializerModifier();</span>

    /**
     *
     */
    private RiakBeanSerializerModifier()
<span class="fc" id="L53">    {</span>
<span class="fc" id="L54">    }</span>

    public static RiakBeanSerializerModifier getInstance()
    {
<span class="fc" id="L58">        return INSTANCE;</span>
    }

    /*
     * (non-Javadoc)
     *
     * @see
     * org.codehaus.jackson.map.ser.BeanSerializerModifier#changeProperties(
     * org.codehaus.jackson.map.SerializationConfig,
     * org.codehaus.jackson.map.introspect.BasicBeanDescription, java.util.List)
     */
    @Override
    public List&lt;BeanPropertyWriter&gt; changeProperties(SerializationConfig config,
                                                     BeanDescription beanDesc,
                                                     List&lt;BeanPropertyWriter&gt; beanProperties)
    {
<span class="fc" id="L74">        final List&lt;BeanPropertyWriter&gt; keptProperties = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L75" title="All 2 branches covered.">        for (BeanPropertyWriter w : beanProperties)</span>
        {
<span class="fc bfc" id="L77" title="All 2 branches covered.">            if (keepProperty(w))</span>
            {
<span class="fc" id="L79">                keptProperties.add(w);</span>
            }
<span class="fc" id="L81">        }</span>

<span class="fc" id="L83">        return keptProperties;</span>
    }

<span class="fc" id="L86">    static final List&lt;Class&lt;? extends Annotation&gt;&gt; RIAK_ANNOTATIONS = new ArrayList&lt;&gt;();</span>

    static
    {
<span class="fc" id="L90">        RIAK_ANNOTATIONS.add(RiakKey.class);</span>
<span class="fc" id="L91">        RIAK_ANNOTATIONS.add(RiakBucketName.class);</span>
<span class="fc" id="L92">        RIAK_ANNOTATIONS.add(RiakBucketType.class);</span>
<span class="fc" id="L93">        RIAK_ANNOTATIONS.add(RiakContentType.class);</span>
<span class="fc" id="L94">        RIAK_ANNOTATIONS.add(RiakVTag.class);</span>
<span class="fc" id="L95">        RIAK_ANNOTATIONS.add(RiakLastModified.class);</span>
<span class="fc" id="L96">        RIAK_ANNOTATIONS.add(RiakUsermeta.class);</span>
<span class="fc" id="L97">        RIAK_ANNOTATIONS.add(RiakLinks.class);</span>
<span class="fc" id="L98">        RIAK_ANNOTATIONS.add(RiakIndex.class);</span>
<span class="fc" id="L99">        RIAK_ANNOTATIONS.add(RiakVClock.class);</span>
<span class="fc" id="L100">        RIAK_ANNOTATIONS.add(RiakTombstone.class);</span>
<span class="fc" id="L101">    }</span>

    /**
     * Checks if the property has any of the Riak annotations on it or the
     * Jackson JsonProperty annotation.
     *
     * If a Riak annotation is present without the Jackson JsonProperty
     * annotation, this will return false.
     *
     * If a property has been annotated with both the Jackson JsonProperty
     * annotation and a Riak annotation, the Jackson annotation takes precedent
     * and this will return true.
     *
     * @param beanPropertyWriter a {@link BeanPropertyWriter} to check for Riak*
     * annotations
     * @return true if the property is not Riak annotated or is Jackson
     * JsonProperty annotated, false otherwise
     */
    private boolean keepProperty(BeanPropertyWriter beanPropertyWriter)
    {
<span class="fc bfc" id="L121" title="All 2 branches covered.">        if (beanPropertyWriter.getAnnotation(JsonProperty.class) != null)</span>
        {
<span class="fc" id="L123">            return true;</span>
        }
<span class="fc bfc" id="L125" title="All 2 branches covered.">        for (Class&lt;? extends Annotation&gt; annotation : RIAK_ANNOTATIONS)</span>
        {
<span class="fc bfc" id="L127" title="All 2 branches covered.">            if (beanPropertyWriter.getAnnotation(annotation) != null)</span>
            {
<span class="fc" id="L129">                return false;</span>
            }
<span class="fc" id="L131">        }</span>
<span class="fc" id="L132">        return true;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>